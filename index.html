<!doctype html>
<html>
	<head>
		<title>Curriculum Explorer</title>
		<script src="https://cdn.jsdelivr.net/npm/pixi.js@7.x/dist/pixi.js"></script>
	</head>
	<body style="margin:0; overflow: hidden;" onload='

class Node {
	constructor(x, y, size, anchors = ["top", "left"]) {
		this.x = x + size/2;
		this.y = y + size/2;
		this.direction = {x: 1, y: 1};
		for (const anchor of anchors) {
			switch (anchor) {
				case "top":
					this.direction.y = 1;
					break;
				case "left":
					this.direction.x = 1;
					break;
				case "bottom":
					this.direction.y = -1;
					this.y += app.screen.height - 2*y;
					break;
				case "right":
					this.direction.x = -1;
					this.x += app.screen.width - 2*x;
					break;
				case "center":
					this.direction.x = 0;
					this.direction.y = 0;
					this.x += app.screen.width/2;
					this.y += app.screen.height/2;
					break;
			}
		}
		this.size = size;
		this.color = 0xabcdef;
		this.connections = [];
	}
	draw() {
		graphics.lineStyle(2, 0xffffff);
		for (const node of this.connections) {
			graphics.moveTo(this.x + this.size/2 * this.direction.x, this.y + this.size/2 * this.direction.y);
			graphics.lineTo(node.x + node.size/2 * node.direction.x, node.y + node.size/2 * node.direction.y);
		}
		graphics.lineStyle(0, 0xffffff);
		graphics.beginFill(this.color);
		graphics.drawRect(
			this.x - this.size/2 + this.size/2 * this.direction.x,
			this.y - this.size/2 + this.size/2 * this.direction.y,
			this.size, this.size);
		graphics.endFill();
	}
	get hitbox() {
		return new PIXI.Rectangle(
			this.x - this.size/2 + this.size/2 * this.direction.x,
			this.y - this.size/2 + this.size/2 * this.direction.y,
			this.size, this.size);
	}
}

class Course extends Node {
	constructor(x, y, size, name = "Course Name", desc = "Summary", id = "ID", prereqs = [], coreqs = []) {
		super(x, y, size, ["left", "top"]);
		this.texts = [];
		this.#addText(name, 20, 4, 4);
		this.#addText(desc, 16, 4, 32);
		this.id = id;
		this.prereqs = prereqs;
		this.coreqs = coreqs;
	}
	move(dx, dy) {
		this.x += dx;
		this.y += dy;
		for (const text of this.texts) {
			text.x += dx;
			text.y += dy;
		}
	}
	#addText(content, size, x, y) {
		const text = new PIXI.Text(content, {fontSize: size, wordWrap: true, wordWrapWidth: this.size-8});
		text.x = this.x - this.size/2 + this.size/2 * this.direction.x + x;
		text.y = this.y - this.size/2 + this.size/2 * this.direction.y + y;
		app.stage.addChild(text);
		this.texts.push(text);
	}
}

class Button extends Node {
	constructor(x, y, size, icon = "", onClick = () => 0, anchors = ["top", "left"]) {
		super(x, y, size, anchors);
		this.onClick = onClick;
		this.icon = new PIXI.Text(icon, {fontSize: size});
		this.icon.x = this.x + (size-this.icon.width)/2;
		this.icon.y = this.y + (size-this.icon.height)/2;
		app.stage.addChild(this.icon);
	}
	move(dx, dy) {
		this.onClick();
	}
}

PIXI.settings.ROUND_PIXELS = true;
const app = new PIXI.Application({background: 0x123456, resizeTo: window, resolution: window.devicePixelRatio, autoDensity: true});
const graphics = new PIXI.Graphics();
app.stage.addChild(graphics);
app.stage.eventMode = "static";
app.stage.hitArea = app.screen;
app.stage.interactiveChildren = false;
app.stage.on("pointerdown", onClick);
app.stage.on("pointermove", onMove);
app.stage.on("pointerup", () => drag = false);
app.renderer.on("resize", onWindowResize)
app.ticker.add(draw);
window.setInterval(() => console.log("FPS:", app.ticker.FPS), 1000);

function draw(delta) {
	graphics.clear();
	const shortestSide = Math.min(app.screen.width, app.screen.height);
	for (const node of nodes) node.draw(shortestSide);
}

function onClick(event) {
	for (const node of nodes) if (node.hitbox.contains(event.global.x, event.global.y)) {
		drag = node;
		return;
	}
	drag = true;
}

function onMove(event) {
	if (drag === true) for (const node of nodes) node.move(event.movement.x, event.movement.y);
	else if (drag) drag.move(event.movement.x, event.movement.y);
}

function onWindowResize(width, height) {
	for (const node of nodes) node.move((width - oldWindowSize.x) / 2, (height - oldWindowSize.y) / 2);
	oldWindowSize = {x: width, y: height};
}

const nodes = [
	new Course(-100, -100, 150),
	new Course(100, 50, 150),
	new Button(50, 50, 50, "+", () => console.log("pressed top left"), ["top", "left"]),
	new Button(50, 50, 50, "+", () => console.log("pressed top right"), ["top", "right"]),
	new Button(50, 50, 50, "+", () => console.log("pressed bottom left"), ["bottom", "left"]),
	new Button(50, 50, 50, "+", () => console.log("pressed bottom right"), ["bottom", "right"])];
nodes[0].connections.push(nodes[1]);
var drag = false;
var oldWindowSize = {x: app.screen.width, y: app.screen.height};
document.body.appendChild(app.view);

'></body>
</html>